{% extends 'shop_template.html' %}
{% load staticfiles %}
{% block title %}Catalogue{% endblock %}
{% block content %}

<!--Product Cards-->
{% if displayProducts %}
    <div class="container-fluid">
        <div class="grid-prod" id="product-cards"></div>
    </div>
    <script>start_sort()</script>
{% endif  %}

{% if displayCategories %}
    {% for sub_subcategory in subSubCategories %}
        <p><a href="{% url 'getOneCategoryProducts' sub_subcategory.unique_identificator %}">{{ sub_subcategory.title }}</a></p>
    {% endfor %}
{% endif %}

<!--Big Images-->
<!--New-->
	<div class="img-block" id="big-img">
		<i class="fa fa-times close-icon" id="close_images_block" aria-hidden="true"></i>
		<div class="btns-all-images">
			<p class="name">Бримэнс тумба</p>
			<p class="price">29000 грн.</p>
			<div class="button-item">
     			<a href="" class="btn-1">Добавить в корзину</a>
    		</div>
		</div>
		<div class="mini-img-list">
        </div>
 	</div>


<!--
	<div class="img-block">
        <i class="fa fa-times close-icon" id="close_images_block" aria-hidden="true"></i>
        <div class="mini-img-list"></div>
        <div id="price">
        <div id="description"></div>
    </div>
-->
</div>
{% endblock %}

{% block js %}
    <script>

        //*начальный контент без сортировки
        function start_sort(){
            loader_show(); //*показываем лоадер
            var token = $('input[name="csrfmiddlewaretoken"]').val();
            var unique_identificator = '{{ category.unique_identificator }}';
            console.log('identificator: ', unique_identificator);
            get_sort('normal', unique_identificator, token);
        };

    </script>
{% endblock %}

{% block onload_js %}
    <script>
        tags_list = ['.img-block', '.get-all-images'];
        hide_tags(tags_list);
        hover_product_card();

        //*сортировка*//
        $('body').on('change', '#get_sort', function () {
            hide_tags(['#product-cards']); //*скрываем контент с карточками
            remove_tags(['.card']); //*удаляем неосортированные карточки продуктов
            loader_show(); //*показываем лоадер
            var sort_by = $(this).find('option:selected').val();
            var token = $('input[name="csrfmiddlewaretoken"]').val();
            var unique_identificator = '{{ category.unique_identificator }}';
            var template = document.getelementById('cardTemplate');
            get_sort(sort_by, unique_identificator, token, template); //*получаем список отсортированных и генерируем контент

        });

        //ajax загрузка изображений артикула
        $('body').on('click', '.get-all-images', function (){
            var token = $('input[name="csrfmiddlewaretoken"]').val();
            var unique_identificator = $(this).data('unique_identificator');
            console.log(unique_identificator);

            $.ajax({
                url: "{% url 'get_all_product_images' %}",
                method: 'post',
                data: {
                    'csrfmiddlewaretoken':token,
                    'unique_identificator':unique_identificator
                },
                success: function (data) {
                    $block_to_paste_images=$('.img-block');
                    $block_to_paste_images.slideDown(function (img) {
                    $block_to_paste_images.prepend('<img class="big-img-item" src="' + data.images[0] + '">');
                    for (i=0; i<data.images.length; i++) {
                        $block_to_paste_images.find('.mini-img-list').append('<img class="mini-img" src="' + data.images[i] + '"></a>');
                    };

                    });
                }

            });

            //клик на маленькое изображение и загрузка большого
            $('.img-block').on('click', '.mini-img', function() {
                var img=$(this);
                $('.big-img-item').attr('src', img.attr('src'));
            })
        });

        //закрытие блока с загруженными изображениями
        $('#close_images_block').click(function () {
            $('.img-block').find('img').remove();
            $('.img-block').slideUp();
        });
    </script>

    <!-- card template -->
<script type="text/card-template" id="cardTemplate">
    <div class="card">
        <div class="card-open">
        <!--Product Images Open-->
            <i class="fa fa-search-plus" on-aria-hidden="true"></i>
            <img src="<%image_url%>" alt=<%product_article_number%>
        <!--Product Info Open-->
            <a class="card-title"><%product_title%></a>
            <p class="ind-code">Артикул: <%product_article_number%></p>
            <p class="card-text"><%product_description%></p>
            <p class="card-price"><%product_price%> грн.</p>
            <div class="button-item">
                <a href="" class="btn-1">Добавить в корзину</a>
            </div>
        </div>
        <!--Product Images-->
            <i class="fa fa-search-plus" onaria-hidden="true"></i>
            <img src="<%image_url%>" alt="<%product_article_number%>">
        <!--Product Info-->
            <a class="card-title"><%product_title%></a>
            <p class="ind-code">Артикул: <%product_article_number%></p>
                <p class="card-price"><%product_price%> грн.</p>
    </div>
</script>
{% endblock %}
