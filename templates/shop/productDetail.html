{% extends 'shop_template.html' %}

{% block content %}
    <span data-product_article='{{ product.article_number }}' id='article_number'></span>

    <!--One Product-->
	<!--Images-->
	<div class="grid" style="margin-top: 0.5vw">
		<!--Small Images-->
		<div class="one-prod-imgs">
            {% for image in productImages %}
                <div class="small-img"><img class="img-item" src="{{ image.image.url }}" alt="{{ image.title }}"></div>
            {% endfor %}
		</div>
		<!--Large Image-->
		<div class="one-prod-img">
			<div class="large-img"><img class="img-item" src="{{ productImageLarge.image.url }}" alt="{{ productImageLarge.title }}"></div>
		</div>
		<!--Info Block-->
		<div class="info-block" id="info-block">
			<!--Name-->
			<div class="prod-name">{{ product.title }}</div>
			<!--Info-->
            <div class="prod-info">{{ product.description }}</div>
			<div class="prod-price">{{ product.price }}</div>
			<!--Buttons-->
			<div class="prod-btns">
                	<div class="button-item">
     					<a href="" class="btn-1">Добавить в корзину</a>
                        <div class="amount"><span>В наличии:</span><span id="product_available"></span></div>
    				</div>
			</div>
		</div>
	</div>
	<!--Pages Block-->
	<main class="grid" id="pages-block">
        {% if product.key_feautures%}
  		    <input id="tab1" type="radio" name="tabs" checked>
  			<label for="tab1">Описание</label>
        {% endif %}

        {% if product.goot_to_know or product.care_instructions or product.materials_info %}
  		    <input id="tab2" type="radio" name="tabs">
  			<label for="tab2">Информация</label>
        {% endif %}

        {% if product.dimensions %}
  		    <input id="tab3" type="radio" name="tabs">
  			<label for="tab3">Размеры</label>
        {% endif %}

  		<input id="tab4" type="radio" name="tabs">
        <label for="tab4">Дополняющие товары</label>

  {% if product.key_feautures %}
  <section id="content1">
    <p>
        <h3>Описание</h3>
        <span>{{ product.key_feautures }}</span>
    </p>
  </section>
  {% endif %}

  {% if product.goot_to_know or product.care_instructions or product.materials_info %}
  <section id="content2">
    {% if product.goot_to_know %}
    <p>
        <h3>Полезно знать</h3>
        <span>{{ product.good_to_know }}</span>
    </p>
    {% endif %}

    {% if product.care_instruction %}
    <p>
        <h3>Инострукция по уходу</h3>
        <span>{{ product.care_instructions }}</span>
    </p>
    {% endif %}

    {% if product.materials_info %}
    <p>
        <h3>Материалы</h3>
        <span>{{ product.materials_info }}</span>
    </p>
    {% endif %}

  </section>
  {% endif %}

  {% if product.dimensions %}
  <section id="content3">
    <p>
        <h3>Размеры</h3>
        <span>{{ product.dimensions }}</span>
    </p>
  </section>
  {% endif %}

  <section id="content4">

      {% if complementaryProducts %}
          {% for complementary_product in complementaryProducts %}
              <div class="card">
				<div class="card-open">
                <!--Product Images Open-->
					<i class="fa fa-search-plus" aria-hidden="true"></i>
                    {% for image in complementaryProductsImages %}
                        {% for image_product in image.product.all %}
                            {% if image_product == complementary_product %}
                                <img src="{{ image.image.url }}" alt="{{ image.title }}">
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                    <!--Product Info Open-->
                    <a class="card-title" href="{% url 'productDetail' complementary_product.article_number %}">{{ complementary_product.title }}</a>
					<p class="ind-code">Артикул: {{ complementary_product.article_number }}</p>
                    <p class="card-text">{{ complementary_product.description }}</p>
					<p class="card-price">{{ complementary_product.price }} грн.</p>
                	<div class="button-item">
     					<a href="" class="btn-1">Добавить в корзину</a>
    				</div>
            	</div>
                <!--Product Images-->
					<i class="fa fa-search-plus" aria-hidden="true"></i>
                    {% for image in complementaryProductsImages %}
                        {% for image_product in image.product.all %}
                            {% if image_product == complementary_product %}
                                <img src="{{ image.image.url }}" alt="{{ image.title }}">
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                <!--Product Info-->
                    <a class="card-title" href="{% url 'productDetail' complementary_product.article_number %}">{{ complementary_product.title }}</a>
					<p class="ind-code">Артикул: {{ complementary_product.article_number }}</p>
					<p class="card-price">{{ complementary_product.price }} грн.</p>
              </div>
          {% endfor %}
      {% endif %}

  </section>
</main>


    <!--старый код-->

    {% if colorOptions %}
        <p>
            <h3>Цвета</h3>
                    {% for color in colorOptions %}
                        {% for image in complementaryImages %}
                            {% for product in image.product.all %}
                                {% if color == product %}
                                    <img src="{{ image.image.url }}" class="icon-image"><a href="{% url 'productDetail' color %}">{{ color }}</a>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
        </p>
    {% endif %}

    {% if sizeOptions %}
        <p>
            <h3>Размеры</h3>
            {% for size in sizeOptions %}
                {% for image in complementaryImages %}
                    {% for product in image.product.all %}
                        {% if size == product %}
                            <p><img src="{{ image.image.url }}" class="icon-image">
                        {% endif %}
                    {% endfor %}
                {% endfor %}
               <a href="{% url 'productDetail' size %}">{{ size }}</a></p>
            {% endfor %}
        </p>
    {% endif %}

    {% if modelOptions %}
            <h3>Модели</h3>
            {% for model in modelOptions %}
                {% for image in complementaryImages %}
                    {% for product in image.product.all %}
                        {% if model == product %}
                            <p><img src="{{ image.image.url }}" class="icon-image">
                        {% endif %}
                    {% endfor %}
                {% endfor %}
               <a href="{% url 'productDetail' model %}">{{ model }}</a></p>
            {% endfor %}
    {% endif %}


{% endblock %}

{% block js %}
    <script>
    </script>
{% endblock %}

{% block onload_js %}
    <script>
        var article_number_ = $('#article_number').data('product_article');
        console.log(article_number_);
        check_availability(article_number_);

        function check_availability(article_number){
            console.log(article_number);
            var token = $('input[name="csrfmiddlewaretoken"]').val();
            $.ajax({
                url:'{% url "checkAvailability" %}',
                method:'POST',
                data:{
                    'csrfmiddlewaretoken':token,
                    'article_number':article_number
                },
                success: function (data) {
                    $to_paste = $('#product_available');
                    if (data.availability){
                        $to_paste.text(data.availability).css('color', 'green');
                    } else if (data.successMessage){
                        $to_paste.text(data.successMessage).css('color', 'green');
                    } else if (data.errorMessage){
                        $to_paste.text(data.errorMessage).css('color', 'red');
                    }
                },
                error: function () {
                    return ('функция недоступна, попробуйте позже')
                }
            });
        }

        $('.small-img .img-item').click(function () {
           var image_url = $(this).attr('src');
           console.log(image_url);
           $('.large-img.img-item').attr('src', image_url);
        });

        $('.large-img').on('click', $('.img-item'), function (e) {
            e.preventDefault();
            var image_to_open = $(this).attr('src');
            $('.large-img img.img-item').attr('src', image_to_open);
        });

    </script>
{% endblock %}
