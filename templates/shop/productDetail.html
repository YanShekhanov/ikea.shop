{% extends 'shop_template.html' %}

{% block content %}


    <h3>{{ product.title }}<br>{{ product.article_number }}<br>{{ product.description }}</h3>
    <span>Цена: <b>{{ product.price }} PLN</b></span><br>

    <span id="availability">Наличие: <b><button id="check_availabiliti_button" onclick="check_availability({{ product.article_number }})">Узнать наличие в Польше</button></b></span>

    {% for image in productImages %}
        <p><img src="{{ image.image.url }}" alt="{{ image.title }}" style="margin: 5px; border: 2px solid black; display: inline-block;"
            height="200px" width="200px"></p>
    {% endfor %}

    {% if colorOptions %}
        <p>
            <h3>Цвета</h3>
                <select>
                    {% for color in colorOptions %}
                        {% for image in complementaryImages %}
                            {% for product in image.product.all %}
                                {% if color == product %}
                                    <option><img src="{{ image.image.url }}" class="icon-image"><a href="{% url 'productDetail' color %}">{{ color }}</a></option>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                </select>
        </p>
    {% endif %}

    {% if sizeOptions %}
        <p>
            <h3>Размеры</h3>
            {% for size in ziseOptions %}
                {% for image in complementaryImages %}
                    {% for product in image.product.all %}
                        {% if size == product %}
                            <p><img src="{{ image.image.url }}" class="icon-image">
                        {% endif %}
                    {% endfor %}
                {% endfor %}
               <a href="{% url 'productDetail' size %}">{{ size }}</a></p>
            {% endfor %}
        </p>
    {% endif %}

    {% if modelOptions %}
            <h3>Модели</h3>
            {% for model in modelOptions %}
                {% for image in complementaryImages %}
                    {% for product in image.product.all %}
                        {% if model == product %}
                            <p><img src="{{ image.image.url }}" class="icon-image">
                        {% endif %}
                    {% endfor %}
                {% endfor %}
               <a href="{% url 'productDetail' model %}">{{ model }}</a></p>
            {% endfor %}
    {% endif %}

    <p>
        <h3>Описание</h3>
        <span>{{ product.key_feautures }}</span>
    </p>

    <p>
        <h3>Полезно знать</h3>
        <span>{{ product.good_to_know }}</span>
    </p>

    <p>
        <h3>Инострукция по уходу</h3>
        <span>{{ product.care_instructions }}</span>
    </p>

    <p>
        <h3>Материалы</h3>
        <span>{{ product.materials_info }}</span>
    </p>

    <p>
        <h3>Размеры</h3>
        <span>{{ product.dimensions }}</span>
    </p>

    {% if complementaryProducts is not None %}
    <p>
        <h3>Дополняющие продукты</h3>
        {% for complementary_product in complementaryProducts %}
            <p>
                <a href="{% url 'productDetail' complementary_product.article_number %}">{{ complementary_product.article_number }}</a>
                {% for complementary_image in complementaryProductsImages %}
                    {% if complementary_image.product == complementary_product %}
                        <img src="{{ complementary_image.image.url }}" alt="{{ complementary_product.article_number }}" height="50px" width="50px">
                    {% endif %}
                {% endfor %}
            </p>
        {% endfor %}
    </p>
    {% endif %}



{% endblock %}

{% block js %}
    <script>
        function check_availability(article_number){
            var token = $('input[name="csrfmiddlewaretoken"]').val();
            $.ajax({
                url:'{% url "checkAvailability" %}',
                method:'POST',
                data:{
                    'csrfmiddlewaretoken':token,
                    'article_number':article_number
                },
                success: function (data) {
                    if (data.availability){
                        $('#check_availabiliti_button').hide();
                        $('#availability').find('b').text(data.availability);
                    } else if (data.successMessage){
                        $('#check_availabiliti_button').hide();
                        $('#availability').find('b').text(data.successMessage);
                    } else if (data.errorMessage){
                        $('#check_availabiliti_button').hide();
                        $('#availability').find('b').text(data.errorMessage);
                    }
                },
                error: function () {
                    $('#availability').text('Возникла ошибка, попробуйте позже');
                }
            });
        }
    </script>
{% endblock %}
